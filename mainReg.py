import numpy as np
import scipy.io
import warnings
import matplotlib.pyplot as plt

warnings.filterwarnings('ignore')

try:
    from EQPreg import EQPreg
except ImportError:
    print("EQPreg module not found, using placeholder.")
    def EQPreg(t, x):
        n = len(t) if isinstance(t, np.ndarray) else 1
        return (np.zeros(n), np.zeros(n), np.zeros(n), 
                np.zeros(n), np.zeros(n), np.zeros(n), np.zeros(n))

print("Loading data...")
data_vars = {}

for i in range(1, 7):
    try:
        ga_data = scipy.io.loadmat(f'GA{i}.mat')[f'rga{i}']
    except FileNotFoundError:
        pass

    try:
        sqp_data = scipy.io.loadmat(f'GASQP{i}.mat')[f'rgasqp{i}']
        data_vars[f'{i}c1'] = sqp_data[:20, :94, 0]
        data_vars[f'{i}c2'] = sqp_data[:20, :94, 1]
        data_vars[f'{i}c3'] = sqp_data[:20, :94, 2]
    except FileNotFoundError:
        print(f"GASQP{i}.mat not found, creating dummy data.")
        for c in range(1, 4):
            data_vars[f'{i}c{c}'] = np.zeros((20, 94))

print("Computing model...")
time_steps = np.linspace(0, 10, 41)
num_rows = 20

results_df = {}
results_t = {}

for key, matrix in data_vars.items():
    df_arr = np.zeros((num_rows, len(time_steps)))
    t_arr = np.zeros((num_rows, len(time_steps)))
    
    for i in range(num_rows):
        row_data = matrix[i, :90]
        
        try:
            outputs = EQPreg(time_steps, row_data)
            df_arr[i, :] = outputs[1]
            t_arr[i, :] = outputs[4]
        except Exception as e:
            for idx, val_t in enumerate(time_steps):
                outs = EQPreg([val_t], row_data)
                val_df = outs[1][0] if isinstance(outs[1], (list, np.ndarray)) else outs[1]
                val_theta = outs[4][0] if isinstance(outs[4], (list, np.ndarray)) else outs[4]
                df_arr[i, idx] = val_df
                t_arr[i, idx] = val_theta

    results_df[key] = df_arr
    results_t[key] = t_arr

print("Complete")
# ==========================================
# 4. Reference Data Set (Sc Matrices)
# ==========================================
# MATLAB -> Numpy Array
print("Data loading")

Sc1c1 = np.array([
    [1.0, 1.0],
    [1.18315585695376, 0.833056797937233],
    [1.22537836535194, 0.674010721387139],
    [1.14220262097996, 0.530231391708451],
    [0.977624209157181, 0.406791514452700],
    [0.782805411331398, 0.305608274785129],
    [0.596746470097091, 0.225804013970015],
    [0.43981540347254, 0.164738163027624],
    [0.31739508139856, 0.119063659769119],
    [0.226498696066374, 0.0854660698217930],
    [0.161011856293535, 0.0610466480567271],
    [0.114617308767334, 0.0434491848614386],
    [0.0819928833283547, 0.0308447621199780],
    [0.0590723763234399, 0.0218557668166054],
    [0.042911253740933, 0.0154650871352003],
    [0.0314407232081557, 0.0109318819134072],
    [0.0232306022403933, 0.00772154132594398],
    [0.0172990811964713, 0.00545076282350319],
    [0.0129727473393354, 0.00384602016435276],
    [0.00978786393278736, 0.00271270925337257],
    [0.00742298571605608, 0.00191273730913136],
    [0.00565327768011159, 0.00134827618330334],
    [0.00431982302870877, 0.000950095261887669],
    [0.00330917020754002, 0.000669292944206976],
    [0.0025392967741385, 0.000471289450191838],
    [0.00195036470738792, 0.000331684328060202],
    [0.00149830073236634, 0.000233272009513934],
    [0.00115029662805207, 0.000163899132344308],
    [0.000881773740175319, 0.000114998223343918],
    [0.000674198011411144, 8.05325185968077e-05],
    [0.000513489397150607, 5.62402694822038e-05],
    [0.000388913672316675, 3.91184757176902e-05],
    [0.000292256595046529, 2.70518857523005e-05],
    [0.000217201559235143, 1.85475853907120e-05],
    [0.00015888412305081, 1.25538151289907e-05],
    [0.000113551044396479, 8.32984962237526e-06],
    [7.82968922679856e-05, 5.35295608299600e-06],
    [5.08720546305076e-05, 3.25490165005917e-06],
    [2.95332560578122e-05, 1.77636763873267e-06],
    [1.29263318119897e-05, 7.34361201622080e-07],
    [0, 0]
])

Sc1c2 = np.array([
    [1.0, 1.0],
    [1.28974564936836, 0.822695740422776],
    [1.39223820077294, 0.654243149202589],
    [1.31965201661089, 0.503274276514667],
    [1.12993466734516, 0.375735919510211],
    [0.895651800057000, 0.273602273318922],
    [0.672182136525080, 0.195360712254316],
    [0.487027454052687, 0.137450252806284],
    [0.346055206985693, 0.0956675079349129],
    [0.244004883978693, 0.0660696598777605],
    [0.172168714980575, 0.0453745971428591],
    [0.122237843035546, 0.0310368464454354],
    [0.0876089254981147, 0.0211679115681786],
    [0.0634768221410440, 0.0144063683868745],
    [0.0465039840105641, 0.00978924269482652],
    [0.0344266827716278, 0.00664408439068874],
    [0.0257242783516506, 0.00450544716712813],
    [0.0193755544520413, 0.00305315351907877],
    [0.0146903917819319, 0.00206791778105196],
    [0.0111974627383082, 0.00140003635930091],
    [0.00857053238955398, 0.000947544804964982],
    [0.00658041847300848, 0.000641105260322919],
    [0.00506381681449013, 0.000433668496001185],
    [0.00390244393682467, 0.000293262283597660],
    [0.00300975727491464, 0.000198257049829346],
    [0.00232154357616764, 0.000133981390910652],
    [0.00178971245190972, 9.04959160577170e-05],
    [0.00137800312031860, 6.10822842822403e-05],
    [0.00105883886239522, 4.11880684659100e-05],
    [0.000811143173925241, 2.77315860712520e-05],
    [0.000618760571940855, 1.86311055568900e-05],
    [0.000469244060373318, 1.24766800830925e-05],
    [0.000352982242141694, 8.31421841730376e-06],
    [0.000262548116581223, 5.49939608245101e-06],
    [0.000192183828709499, 3.59590888237007e-06],
    [0.000137421670477384, 2.30856502155315e-06],
    [9.47963527701116e-05, 1.43803878131529e-06],
    [6.16136797290342e-05, 8.49369903646637e-07],
    [3.57785133068572e-05, 4.51254677077161e-07],
    [1.56630330315882e-05, 1.82044542765052e-07],
    [0.0, 0.0]
])

Sc1c3 = np.array([
    [1.0, 1.0],
    [1.39613888561569, 0.813529012169912],
    [1.55683262196713, 0.636853182739373],
    [1.48986827165293, 0.479870334952744],
    [1.26952249136758, 0.349337031656889],
    [0.992933263549557, 0.247141007329465],
    [0.732683508433845, 0.170998204303713],
    [0.52213300399543, 0.116377521909468],
    [0.365999411674029, 0.0782640459343867],
    [0.255737888947738, 0.0521853823890533],
    [0.179708569626893, 0.0345849078705242],
    [0.127658492549005, 0.0228201931656645],
    [0.091887357415331, 0.0150095621077560],
    [0.0670395373405721, 0.00984917516295275],
    [0.0495298231824137, 0.00645173046776320],
    [0.036996719487607, 0.00422071005274399],
    [0.027888077895238, 0.00275845094275815],
    [0.0211762287397777, 0.00180142742020594],
    [0.0161714672346455, 0.00117575142520431],
    [0.0124028184854769, 0.000767037580151128],
    [0.00954253765756826, 0.000500219528908583],
    [0.00735820448089395, 0.000326118774829940],
    [0.00568206284960851, 0.000212555654227993],
    [0.0043912018089346, 0.000138507832779984],
    [0.00339429787589554, 9.02357055543903e-05],
    [0.00262277811853214, 5.87689788392686e-05],
    [0.00202475217284429, 3.82599141839024e-05],
    [0.00156066834767544, 2.48952065928500e-05],
    [0.00120021178368453, 1.61870452618849e-05],
    [0.000920057928939577, 1.05132820462948e-05],
    [0.000702207900893372, 6.81661878836431e-06],
    [0.000532741504832451, 4.40808906222476e-06],
    [0.000400874814237172, 2.83880493625720e-06],
    [0.000298242913620576, 1.81631696433208e-06],
    [0.000218351162204879, 1.15009519784301e-06],
    [0.000156154317750587, 7.16045466605032e-07],
    [0.000107729446335673, 4.33283984384142e-07],
    [7.00246808770214e-05, 2.49085408575814e-07],
    [4.06658324570237e-05, 1.29102265736553e-07],
    [1.78032348250757e-05, 5.09235261417158e-08],
    [0.0, 0.0]
])

Sc2c1 = np.array([
    [1.0, 1.0],
    [1.28974564936836, 0.822695740422776],
    [1.39223820077294, 0.654243149202589],
    [1.31965201661089, 0.503274276514667],
    [1.12993466734516, 0.375735919510211],
    [0.895651800057000, 0.273602273318922],
    [0.672182136525080, 0.195360712254316],
    [0.487027454052687, 0.137450252806284],
    [0.346055206985693, 0.0956675079349129],
    [0.244004883978693, 0.0660696598777605],
    [0.172168714980575, 0.0453745971428591],
    [0.122237843035546, 0.0310368464454354],
    [0.0876089254981147, 0.0211679115681786],
    [0.0634768221410440, 0.0144063683868745],
    [0.0465039840105641, 0.00978924269482652],
    [0.0344266827716278, 0.00664408439068874],
    [0.0257242783516506, 0.00450544716712813],
    [0.0193755544520413, 0.00305315351907877],
    [0.0146903917819319, 0.00206791778105196],
    [0.0111974627383082, 0.00140003635930091],
    [0.00857053238955398, 0.000947544804964982],
    [0.00658041847300848, 0.000641105260322919],
    [0.00506381681449013, 0.000433668496001185],
    [0.00390244393682467, 0.000293262283597660],
    [0.00300975727491464, 0.000198257049829346],
    [0.00232154357616764, 0.000133981390910652],
    [0.00178971245190972, 9.04959160577170e-05],
    [0.00137800312031860, 6.10822842822403e-05],
    [0.00105883886239522, 4.11880684659100e-05],
    [0.000811143173925241, 2.77315860712520e-05],
    [0.000618760571940855, 1.86311055568900e-05],
    [0.000469244060373318, 1.24766800830925e-05],
    [0.000352982242141694, 8.31421841730376e-06],
    [0.000262548116581223, 5.49939608245101e-06],
    [0.000192183828709499, 3.59590888237007e-06],
    [0.000137421670477384, 2.30856502155315e-06],
    [9.47963527701116e-05, 1.43803878131529e-06],
    [6.16136797290342e-05, 8.49369903646637e-07],
    [3.57785133068572e-05, 4.51254677077161e-07],
    [1.56630330315882e-05, 1.82044542765052e-07],
    [0.0, 0.0]
])

Sc2c2 = np.array([
    [1.0, 1.0],
    [1.11188606627458, 0.844615759751208],
    [1.08873217697191, 0.696320684541625],
    [0.968650887259922, 0.561418517812777],
    [0.799085380870383, 0.444086562009814],
    [0.621506612705428, 0.345904332488535],
    [0.462300670535392, 0.266263442703891],
    [0.332759400547622, 0.203180916672733],
    [0.233911542796936, 0.154079844801550],
    [0.161686670316990, 0.116335230615490],
    [0.110448827004281, 0.0875723214722595],
    [0.0748245212895687, 0.0657849881001103],
    [0.0503953911538159, 0.0493488475900631],
    [0.0338018036601919, 0.0369838194915296],
    [0.0226047084554884, 0.0276987963833225],
    [0.0150840175770052, 0.0207352597479274],
    [0.0100492754993074, 0.0155171259057587],
    [0.00668680715257497, 0.0116090833811899],
    [0.00444513167376609, 0.00868329433989895],
    [0.00295265710519400, 0.00649341626160566],
    [0.00196001803406836, 0.00485461652386731],
    [0.00130032368994566, 0.00362832331641627],
    [0.000862259128973500, 0.00271081980265259],
    [0.000571515641810992, 0.00202437517446447],
    [0.000378609266613931, 0.00151078794535875],
    [0.000250682222301084, 0.00112655091647248],
    [0.000165883404838330, 0.000839098501237082],
    [0.000109682356942465, 0.000624042876031383],
    [7.24476840752162e-05, 0.000463155070640550],
    [4.77868671721386e-05, 0.000342795264331440],
    [3.14550993540546e-05, 0.000252750018940583],
    [2.06422590975431e-05, 0.000185385774189777],
    [1.34852549696494e-05, 0.000134991014117503],
    [8.74814172412402e-06, 9.72891258900011e-05],
    [5.61342029411913e-06, 6.90838261234776e-05],
    [3.53951670899973e-06, 4.79836550105405e-05],
    [2.16741240203792e-06, 3.21979763382794e-05],
    [1.25979212898949e-06, 2.03885012122121e-05],
    [6.59531292182688e-07, 1.15539258997295e-05],
    [2.62528139861717e-07, 4.94453776331781e-06],
    [0.0, 0.0]
])

Sc2c3 = np.array([
    [1.0, 1.0],
    [1.05424781928085, 0.851801117709888],
    [0.995469669814071, 0.710155157886022],
    [0.866730404687497, 0.580688963207015],
    [0.708416488262537, 0.467068797957118],
    [0.551308356926218, 0.370730795998241],
    [0.413378743535794, 0.291269295600478],
    [0.301545353778275, 0.227100484450530],
    [0.215627572408223, 0.176088824339928],
    [0.152017532469577, 0.135995277633390],
    [0.106108093606585, 0.104737045730003],
    [0.0735497892860778, 0.0805052946395817],
    [0.0507364816826136, 0.0617947763652698],
    [0.0348831015693344, 0.0473870293194489],
    [0.0239284870000652, 0.0363134706672220],
    [0.0163882114675075, 0.0278135529392539],
    [0.0112118154903671, 0.0212949146109162],
    [0.00766471006432982, 0.0162987982225503],
    [0.00523705902403464, 0.0124711799781662],
    [0.00357697279671598, 0.00953960450899611],
    [0.00244242239427547, 0.00729474536146166],
    [0.00166733181113479, 0.00557595822364871],
    [0.00113799171687991, 0.00426011080411145],
    [0.000776520818420667, 0.00325277404713487],
    [0.000529721226967358, 0.00248165657176191],
    [0.000361226483464748, 0.00189137875879400],
    [0.000246207811661786, 0.00143955149355517],
    [0.000167687153332265, 0.00109369192445596],
    [0.000114087249322452, 0.000828954358795998],
    [7.75017802405530e-05, 0.000626317215889280],
    [5.25271666525764e-05, 0.000471207886010663],
    [3.54796355368247e-05, 0.000352481317714754],
    [2.38438885630739e-05, 0.000261605680323110],
    [1.59010381417657e-05, 0.000192045022138657],
    [1.04793612067187e-05, 0.000138800873984038],
    [6.77884158393721e-06, 9.80468745621021e-05],
    [4.25278927065045e-06, 6.68518272265517e-05],
    [2.52854842897982e-06, 4.29740813860142e-05],
    [1.35168543528111e-06, 2.46976525343718e-05],
    [5.48341583542438e-07, 1.07080532741122e-05],
    [0.0, 0.0]
])

Sc3c1 = np.array([
    [1.0, 1.0],
    [1.28974564936836, 0.822695740422776],
    [1.39223820077294, 0.654243149202589],
    [1.31965201661089, 0.503274276514667],
    [1.12993466734516, 0.375735919510211],
    [0.895651800057000, 0.273602273318922],
    [0.672182136525080, 0.195360712254316],
    [0.487027454052687, 0.137450252806284],
    [0.346055206985693, 0.0956675079349129],
    [0.244004883978693, 0.0660696598777605],
    [0.172168714980575, 0.0453745971428591],
    [0.122237843035546, 0.0310368464454354],
    [0.0876089254981147, 0.0211679115681786],
    [0.0634768221410440, 0.0144063683868745],
    [0.0465039840105641, 0.00978924269482652],
    [0.0344266827716278, 0.00664408439068874],
    [0.0257242783516506, 0.00450544716712813],
    [0.0193755544520413, 0.00305315351907877],
    [0.0146903917819319, 0.00206791778105196],
    [0.0111974627383082, 0.00140003635930091],
    [0.00857053238955398, 0.000947544804964982],
    [0.00658041847300848, 0.000641105260322919],
    [0.00506381681449013, 0.000433668496001185],
    [0.00390244393682467, 0.000293262283597660],
    [0.00300975727491464, 0.000198257049829346],
    [0.00232154357616764, 0.000133981390910652],
    [0.00178971245190972, 9.04959160577170e-05],
    [0.00137800312031860, 6.10822842822403e-05],
    [0.00105883886239522, 4.11880684659100e-05],
    [0.000811143173925241, 2.77315860712520e-05],
    [0.000618760571940855, 1.86311055568900e-05],
    [0.000469244060373318, 1.24766800830925e-05],
    [0.000352982242141694, 8.31421841730376e-06],
    [0.000262548116581223, 5.49939608245101e-06],
    [0.000192183828709499, 3.59590888237007e-06],
    [0.000137421670477384, 2.30856502155315e-06],
    [9.47963527701116e-05, 1.43803878131529e-06],
    [6.16136797290342e-05, 8.49369903646637e-07],
    [3.57785133068572e-05, 4.51254677077161e-07],
    [1.56630330315882e-05, 1.82044542765052e-07],
    [0.0, 0.0]
])

Sc3c2 = np.array([
    [1.0, 1.0],
    [1.28974565149088, 0.694043838441890],
    [1.39223820453274, 0.429396686683750],
    [1.31965202119235, 0.235326181604463],
    [1.12993467199473, 0.114954748195010],
    [0.895651803424354, 0.0508388804600853],
    [0.672182140911796, 0.0207585607383343],
    [0.487027457847135, 0.00797686126985335],
    [0.346055210347494, 0.00293163040547914],
    [0.244004887072290, 0.00104340502476293],
    [0.172168717931263, 0.000362952816432346],
    [0.122237845924779, 0.000124207397382574],
    [0.0876089283730988, 4.20089877399144e-05],
    [0.0634768250262141, 1.40877217206687e-05],
    [0.0465039869166927, 4.69499785794024e-06],
    [0.0344266857019467, 1.55751549899830e-06],
    [0.0257242813055894, 5.14920117989711e-07],
    [0.0193755258302961, 1.69767450130076e-07],
    [0.0146903742517900, 5.58785957250530e-08],
    [0.0111974523064322, 1.83650593583614e-08],
    [0.00857052651451962, 6.02901997041032e-09],
    [0.00658044694987029, 1.97858242090552e-09],
    [0.00506378611629271, 6.47993937089540e-10],
    [0.00390243765129053, 2.12477552167226e-10],
    [0.00300972475550742, 6.94872655956026e-11],
    [0.00232151297734226, 2.28204030962657e-11],
    [0.00178969394031912, 7.49293281137029e-12],
    [0.00137799632420269, 2.46605719147947e-12],
    [0.00105883755953382, 8.11942346386630e-13],
    [0.000811149637532844, 2.67258533539005e-13],
    [0.000618767512615575, 8.78892683840319e-14],
    [0.000469246529269743, 2.88289663613593e-14],
    [0.000352982827219108, 9.44080013832116e-15],
    [0.000262546841821376, 3.09251619358815e-15],
    [0.000192181391388316, 1.01380737223928e-15],
    [0.000137420250046363, 3.32264279658130e-16],
    [9.47956729049292e-05, 1.08441518157342e-16],
    [6.16133669565508e-05, 3.48332866706887e-17],
    [3.57788891594559e-05, 1.06051448690252e-17],
    [1.56634372234822e-05, 2.62915070335886e-18],
    [0.0, 0.0]
])

Sc3c3 = np.array([
    [1.0, 1.0],
    [1.28974565551054, 0.466546796216599],
    [1.39223820934927, 0.140025792562122],
    [1.31965202424232, 0.0255466251335176],
    [1.12993467511939, 0.00286034290848244],
    [0.895651806271176, 0.000208657877404072],
    [0.672182143208865, 1.07729247052696e-05],
    [0.487027458266379, 4.27661537546109e-07],
    [0.346055211458825, 1.40104228934471e-08],
    [0.244004888666965, 3.99969698858300e-10],
    [0.172168719852758, 1.03947834138704e-11],
    [0.122237848064712, 2.54174076171119e-13],
    [0.0876089306593231, 5.92173851369425e-15],
    [0.0634768274115177, 1.33252969468038e-16],
    [0.0465039893702853, 2.92377210994771e-18],
    [0.0344266882036294, 6.29740937827756e-20],
    [0.0257242838419466, 1.33786020386096e-21],
    [0.0193755283922653, 2.75593721464532e-23],
    [0.0146903768331302, 6.20033285771915e-25],
    [0.0111974549027342, 1.38791036754455e-26],
    [0.00857052912258774, 3.09479157397053e-28],
    [0.00658044956734676, 9.67673656005518e-30],
    [0.00506378874140806, 2.43255052431588e-31],
    [0.00390244028266319, 9.37513820611547e-33],
    [0.00300972739204287, 2.80878887052292e-34],
    [0.00232151561818113, 2.24154829411402e-35],
    [0.00178969658473973, 2.14206879102310e-36],
    [0.00137799897159549, 4.49749718582877e-37],
    [0.00105884020938589, 8.52584780011590e-38],
    [0.000811149586363336, 1.36380351019052e-38],
    [0.000618727244443750, 1.39254058167183e-39],
    [0.000469232305291603, -9.03573550115562e-41],
    [0.000352986478151168, 8.48222446433340e-40],
    [0.000262533035465698, -8.76413228985763e-41],
    [0.000192191576048261, 8.65313872168165e-41],
    [0.000137413766421504, 2.02488102578413e-42],
    [9.47955471378094e-05, 9.31052781862760e-43],
    [6.16131251777616e-05, 3.65012601312202e-42],
    [3.57738437204175e-05, -4.45343986009460e-43],
    [1.56644414482785e-05, 5.18199783115488e-43],
    [0.0, 0.0]
])

Sc4c1 = np.array([
    [1.0, 1.0],
    [2.00420160974858, 0.898065616606294],
    [3.10104974952340, 0.763310898916046],
    [3.78494995007436, 0.603955019716278],
    [3.60428277745287, 0.441610092337826],
    [2.74059357028949, 0.300635074282970],
    [1.76481382644726, 0.193980510737293],
    [1.02864704759966, 0.120881996952640],
    [0.572973269321523, 0.0737861523937424],
    [0.317141092790027, 0.0445071481175794],
    [0.179292078593585, 0.0266634294240610],
    [0.105500452709579, 0.0159089787188103],
    [0.0653105847824480, 0.00946840668079890],
    [0.0426348428757434, 0.00562599418269498],
    [0.0292083947033872, 0.00333913838028947],
    [0.0208110757493401, 0.00198026371014175],
    [0.0152679282962721, 0.00117370121467282],
    [0.0114322193577202, 0.000695347186176221],
    [0.00867725606443850, 0.000411810249100088],
    [0.00664394635273194, 0.000243829476437423],
    [0.00511472405249805, 0.000144333931168210],
    [0.00395022304894393, 8.54319732517771e-05],
    [0.00305619892178437, 5.05606842115692e-05],
    [0.00236623772469260, 2.99136123474039e-05],
    [0.00183208482047212, 1.77024000144539e-05],
    [0.00141764946558897, 1.04745979187786e-05],
    [0.00109567424048225, 6.19654622292407e-06],
    [0.000845321327333080, 3.66457379707373e-06],
    [0.000650557086464219, 2.16639975926705e-06],
    [0.000498987205322925, 1.28006294532434e-06],
    [0.000381005485010484, 7.55717535806560e-07],
    [0.000289154562175383, 4.45512228960682e-07],
    [0.000217638040705294, 2.61960568302161e-07],
    [0.000161954140472641, 1.53416696837139e-07],
    [0.000118588057281921, 8.91228023010662e-08],
    [8.48189305126402e-05, 5.10976237809901e-08],
    [5.85212315006969e-05, 2.85988676510537e-08],
    [3.80418830010361e-05, 1.52894241610019e-08],
    [2.20932910397280e-05, 7.41547114770637e-09],
    [9.67308132829252e-06, 2.75731650255084e-09],
    [0.0, 0.0]
])

Sc4c2 = np.array([
    [1.0, 1.0],
    [1.28974564936836, 0.822695740422776],
    [1.39223820077294, 0.654243149202589],
    [1.31965201661089, 0.503274276514667],
    [1.12993466734516, 0.375735919510211],
    [0.895651800057000, 0.273602273318922],
    [0.672182136525080, 0.195360712254316],
    [0.487027454052687, 0.137450252806284],
    [0.346055206985693, 0.0956675079349129],
    [0.244004883978693, 0.0660696598777605],
    [0.172168714980575, 0.0453745971428591],
    [0.122237843035546, 0.0310368464454354],
    [0.0876089254981147, 0.0211679115681786],
    [0.0634768221410440, 0.0144063683868745],
    [0.0465039840105641, 0.00978924269482652],
    [0.0344266827716278, 0.00664408439068874],
    [0.0257242783516506, 0.00450544716712813],
    [0.0193755544520413, 0.00305315351907877],
    [0.0146903917819319, 0.00206791778105196],
    [0.0111974627383082, 0.00140003635930091],
    [0.00857053238955398, 0.000947544804964982],
    [0.00658041847300848, 0.000641105260322919],
    [0.00506381681449013, 0.000433668496001185],
    [0.00390244393682467, 0.000293262283597660],
    [0.00300975727491464, 0.000198257049829346],
    [0.00232154357616764, 0.000133981390910652],
    [0.00178971245190972, 9.04959160577170e-05],
    [0.00137800312031860, 6.10822842822403e-05],
    [0.00105883886239522, 4.11880684659100e-05],
    [0.000811143173925241, 2.77315860712520e-05],
    [0.000618760571940855, 1.86311055568900e-05],
    [0.000469244060373318, 1.24766800830925e-05],
    [0.000352982242141694, 8.31421841730376e-06],
    [0.000262548116581223, 5.49939608245101e-06],
    [0.000192183828709499, 3.59590888237007e-06],
    [0.000137421670477384, 2.30856502155315e-06],
    [9.47963527701116e-05, 1.43803878131529e-06],
    [6.16136797290342e-05, 8.49369903646637e-07],
    [3.57785133068572e-05, 4.51254677077161e-07],
    [1.56630330315882e-05, 1.82044542765052e-07],
    [0.0, 0.0]
])

Sc4c3 = np.array([
    [1.0, 1.0],
    [0.842266746194535, 0.650936418743987],
    [0.663251105013100, 0.414283106431302],
    [0.502753581973658, 0.259063419658611],
    [0.374176934765443, 0.159838830787819],
    [0.276956127183302, 0.0976257175296594],
    [0.205413434878197, 0.0591760050398710],
    [0.153236327497014, 0.0356650332182957],
    [0.115125697574175, 0.0214023717327313],
    [0.0870975556412319, 0.0128012865524285],
    [0.0662993071072138, 0.00763757028543563],
    [0.0507254112275148, 0.00454800315707726],
    [0.0389677486670933, 0.00270422522718017],
    [0.0300297327501977, 0.00160608866908448],
    [0.0231971717590780, 0.000953042364947767],
    [0.0179511476859624, 0.000565141839588485],
    [0.0139095914502079, 0.000334943836294542],
    [0.0107878845590491, 0.000198429978618800],
    [0.00837187770669854, 0.000117509006653636],
    [0.00649931965604993, 6.95770698743172e-05],
    [0.00504631238322052, 4.11916825082986e-05],
    [0.00391784262960307, 2.43803691627471e-05],
    [0.00304087163912741, 1.44280814513426e-05],
    [0.00235902257778132, 8.53817951837419e-06],
    [0.00182866244680532, 5.05178171759464e-06],
    [0.00141602058550492, 2.98859118788092e-06],
    [0.00109490261144323, 1.76791321828823e-06],
    [0.000844957378451367, 1.04551831593503e-06],
    [0.000650387211619100, 6.18090123162662e-07],
    [0.000498911123470421, 3.65237328711657e-07],
    [0.000380971314509248, 2.15614669210750e-07],
    [0.000289138671342909, 1.27092509302773e-07],
    [0.000217632018537287, 7.47287729775680e-08],
    [0.000161948594381697, 4.37445570960658e-08],
    [0.000118586361416145, 2.54138094934497e-08],
    [8.48188436655416e-05, 1.45708567500810e-08],
    [5.85217180730984e-05, 8.15508133354061e-09],
    [3.80423223670307e-05, 4.35946088697526e-09],
    [2.20937151549923e-05, 2.11430819704745e-09],
    [9.67304342962326e-06, 7.85883714847907e-10],
    [0.0, 0.0]
])

Sc5c1 = np.array([
    [1.0, 1.0],
    [1.28974564936836, 0.822695740422776],
    [1.39223820077294, 0.654243149202589],
    [1.31965201661089, 0.503274276514667],
    [1.12993466734516, 0.375735919510211],
    [0.895651800057000, 0.273602273318922],
    [0.672182136525080, 0.195360712254316],
    [0.487027454052687, 0.137450252806284],
    [0.346055206985693, 0.0956675079349129],
    [0.244004883978693, 0.0660696598777605],
    [0.172168714980575, 0.0453745971428591],
    [0.122237843035546, 0.0310368464454354],
    [0.0876089254981147, 0.0211679115681786],
    [0.0634768221410440, 0.0144063683868745],
    [0.0465039840105641, 0.00978924269482652],
    [0.0344266827716278, 0.00664408439068874],
    [0.0257242783516506, 0.00450544716712813],
    [0.0193755544520413, 0.00305315351907877],
    [0.0146903917819319, 0.00206791778105196],
    [0.0111974627383082, 0.00140003635930091],
    [0.00857053238955398, 0.000947544804964982],
    [0.00658041847300848, 0.000641105260322919],
    [0.00506381681449013, 0.000433668496001185],
    [0.00390244393682467, 0.000293262283597660],
    [0.00300975727491464, 0.000198257049829346],
    [0.00232154357616764, 0.000133981390910652],
    [0.00178971245190972, 9.04959160577170e-05],
    [0.00137800312031860, 6.10822842822403e-05],
    [0.00105883886239522, 4.11880684659100e-05],
    [0.000811143173925241, 2.77315860712520e-05],
    [0.000618760571940855, 1.86311055568900e-05],
    [0.000469244060373318, 1.24766800830925e-05],
    [0.000352982242141694, 8.31421841730376e-06],
    [0.000262548116581223, 5.49939608245101e-06],
    [0.000192183828709499, 3.59590888237007e-06],
    [0.000137421670477384, 2.30856502155315e-06],
    [9.47963527701116e-05, 1.43803878131529e-06],
    [6.16136797290342e-05, 8.49369903646637e-07],
    [3.57785133068572e-05, 4.51254677077161e-07],
    [1.56630330315882e-05, 1.82044542765052e-07],
    [0.0, 0.0]
])

Sc5c2 = np.array([
    [1.0, 1.0],
    [1.12897355363860, 0.801991741750675],
    [1.10426851716653, 0.617476044830486],
    [0.967022164522179, 0.457616223892579],
    [0.778704930430273, 0.328185486470020],
    [0.591091213164746, 0.229222183298179],
    [0.432294727147314, 0.156888736080319],
    [0.310055513561947, 0.105774757526215],
    [0.220978183952278, 0.0705312120965520],
    [0.157901813707945, 0.0466540605501494],
    [0.113731546048969, 0.0306793823948039],
    [0.0827863349116461, 0.0200875600815405],
    [0.0609393378997348, 0.0131103867932597],
    [0.0453354917782821, 0.00853614677002458],
    [0.0340434430082374, 0.00554781725413878],
    [0.0257648146633532, 0.00360068471083006],
    [0.0196229588961282, 0.00233447739683832],
    [0.0150194433397637, 0.00151232400660543],
    [0.0115394595658127, 0.000979101880156338],
    [0.00889068673860247, 0.000633570129399933],
    [0.00686366515527693, 0.000409818916129921],
    [0.00530595560340412, 0.000265014419567670],
    [0.00410497972601267, 0.000171323092624271],
    [0.00317678212688749, 0.000110726859012243],
    [0.00245808336900762, 7.15484443978120e-05],
    [0.00190079287093847, 4.62179567999415e-05],
    [0.00146820830358985, 2.98444628547463e-05],
    [0.00113216082006268, 1.92628894218518e-05],
    [0.000870939576352673, 1.24237949119910e-05],
    [0.000667793457881383, 8.00420719916371e-06],
    [0.000509759306696757, 5.14857534638986e-06],
    [0.000386782871396399, 3.30320823819071e-06],
    [0.000291069404053139, 2.11083025343223e-06],
    [0.000216564972184199, 1.34046839713868e-06],
    [0.000158561280349826, 8.42679275897131e-07],
    [0.000113400518415617, 5.21051089407058e-07],
    [7.82373211600431e-05, 3.13264138164792e-07],
    [5.08561404977265e-05, 1.79000990105178e-07],
    [2.95341789340555e-05, 9.22534896011004e-08],
    [1.29303946995354e-05, 3.62115826898313e-08],
    [0.0, 0.0]
])

Sc5c3 = np.array([
    [1.0, 1.0],
    [0.994320819006556, 0.762560193754216],
    [0.868759946992591, 0.549586377883927],
    [0.688312110359231, 0.376946726596829],
    [0.510764423875151, 0.248399217248286],
    [0.365542541312697, 0.158771338898615],
    [0.258188023027489, 0.0992219721880104],
    [0.182807472609449, 0.0609959035944955],
    [0.130895338265204, 0.0370488116321650],
    [0.0951131320074923, 0.0223050927589776],
    [0.0701381653816283, 0.0133405393562515],
    [0.0523945832804944, 0.00793948940275352],
    [0.0395526639653756, 0.00470740325351250],
    [0.0301007609108339, 0.00278307872810632],
    [0.0230460302911623, 0.00164177744578159],
    [0.0177223062801602, 0.000966870387765295],
    [0.0136712318312148, 0.000568661301642543],
    [0.0105694843836413, 0.000334117264086566],
    [0.00818382469651171, 0.000196149482202776],
    [0.00634293694873927, 0.000115088137042708],
    [0.00491901914282432, 6.74982762401614e-05],
    [0.00381566815496994, 3.95682534325097e-05],
    [0.00295965548495727, 2.31896216209226e-05],
    [0.00229490900428868, 1.35882068376970e-05],
    [0.00177831575945150, 7.95968160184813e-06],
    [0.00137666096495588, 4.66196085477121e-06],
    [0.00106424869013781, 2.73011864894831e-06],
    [0.000821170960066993, 1.59824131082303e-06],
    [0.000632003793515914, 9.35355431820134e-07],
    [0.000484765213451566, 5.47153502408226e-07],
    [0.000370143270146113, 3.19759697206364e-07],
    [0.000280906498212659, 1.86611384541933e-07],
    [0.000211427355311826, 1.08647844508539e-07],
    [0.000157326482256091, 6.29848304656019e-08],
    [0.000115199487855509, 3.62495209306814e-08],
    [8.23950160889401e-05, 2.05959356368046e-08],
    [5.68485472823319e-05, 1.14281023888621e-08],
    [3.69544417990002e-05, 6.06059502391215e-09],
    [2.14617789900739e-05, 2.91798231219390e-09],
    [9.39624338066142e-06, 1.07747852599476e-09],
    [0.0, 0.0]
])

Sc6c1 = np.array([
    [1.0, 1.0],
    [0.912602208792598, 0.862416009989720],
    [0.809681223051812, 0.730415718484221],
    [0.702664288459875, 0.608443271290180],
    [0.599083280445995, 0.499398512790594],
    [0.503458759678554, 0.404646168731029],
    [0.418108797904481, 0.324275237486077],
    [0.343830882103015, 0.257464814292222],
    [0.280440146642721, 0.202846496078508],
    [0.227170633391289, 0.158802407229325],
    [0.182958803415735, 0.123678695354428],
    [0.146633149137991, 0.0959196805542402],
    [0.117033313091403, 0.0741393842242965],
    [0.0930787106866900, 0.0571487857799948],
    [0.0738029458434043, 0.0439556293581909],
    [0.0583659960837968, 0.0337486782251583],
    [0.0460528617602033, 0.0258749265459366],
    [0.0362646271175069, 0.0198149563135624],
    [0.0285058500633369, 0.0151593818944730],
    [0.0223707437188928, 0.0115878252545939],
    [0.0175296111014154, 0.00885094414719028],
    [0.0137163280883240, 0.00675551375123910],
    [0.0107172428476689, 0.00515229751276452],
    [0.00836159794914752, 0.00392633390835717],
    [0.00651342979357901, 0.00298924499218955],
    [0.00506482006434173, 0.00227319734165993],
    [0.00393033889928444, 0.00172619090761128],
    [0.00304251146646003, 0.00130840190341354],
    [0.00234814685800901, 0.000989354691430213],
    [0.00180538321566860, 0.000745741168094952],
    [0.00138132116230261, 0.000559743225467548],
    [0.00105013622180013, 0.000417744504698124],
    [0.000791578467965129, 0.000309342457934801],
    [0.000589783418755832, 0.000226591519961344],
    [0.000432331915814036, 0.000163423806257191],
    [0.000309508399075975, 0.000115205981567565],
    [0.000213716744786309, 7.84004606637057e-05],
    [0.000139020892036631, 5.03064778897590e-05],
    [8.07840688883165e-05, 2.88622570129697e-05],
    [3.53857702896790e-05, 1.24938988785443e-05],
    [0.0, 0.0]
])

Sc6c2 = np.array([
    [1.0, 1.0],
    [1.02287615995482, 0.849162004266693],
    [0.974069094282408, 0.704864709702328],
    [0.877967039653956, 0.572705447141778],
    [0.757779706030151, 0.456457463575106],
    [0.632152691527516, 0.357794875183371],
    [0.513678245685519, 0.276565419775604],
    [0.409236495979300, 0.211346509140467],
    [0.321358937747586, 0.160031678808016],
    [0.249802680460960, 0.120299124866269],
    [0.192861261124388, 0.0899182730689491],
    [0.148264560753737, 0.0669130331851055],
    [0.113707896344291, 0.0496230391886508],
    [0.0871145765556769, 0.0367031259505452],
    [0.0667333315531201, 0.0270913266318230],
    [0.0511459940183696, 0.0199647639165903],
    [0.0392335463975748, 0.0146945820226753],
    [0.0301274008504374, 0.0108049608108804],
    [0.0231604165935490, 0.00793861465392948],
    [0.0178234728280359, 0.00582882694514150],
    [0.0137292948259493, 0.00427730848832795],
    [0.0105836834152171, 0.00313711133853120],
    [0.00816330204706328, 0.00229968485726481],
    [0.00629817037819966, 0.00168484417463905],
    [0.00485899488341994, 0.00123358198586731],
    [0.00374712634216300, 0.000902459561143453],
    [0.00288717298292532, 0.000659538071500895],
    [0.00222140250558232, 0.000481349507633490],
    [0.00170551982605479, 0.000350658754877264],
    [0.00130547726690518, 0.000254813121717500],
    [0.000995059560703370, 0.000184526770259489],
    [0.000754051021547406, 0.000132986385015957],
    [0.000566841015088878, 9.51937141469703e-05],
    [0.000421360235058762, 6.74825437306319e-05],
    [0.000308267344315353, 4.71639946125412e-05],
    [0.000220325638199361, 3.22661469265539e-05],
    [0.000151924336673781, 2.13429616204815e-05],
    [9.87102517695572e-05, 1.33340868559529e-05],
    [5.73039014133511e-05, 7.46201587548746e-06],
    [2.50803812173417e-05, 3.15665472130311e-06],
    [0.0, 0.0]
])

Sc6c3 = np.array([
    [1.0, 1.0],
    [1.28974564936836, 0.822695740422776],
    [1.39223820077294, 0.654243149202589],
    [1.31965201661089, 0.503274276514667],
    [1.12993466734516, 0.375735919510211],
    [0.895651800057000, 0.273602273318922],
    [0.672182136525080, 0.195360712254316],
    [0.487027454052687, 0.137450252806284],
    [0.346055206985693, 0.0956675079349129],
    [0.244004883978693, 0.0660696598777605],
    [0.172168714980575, 0.0453745971428591],
    [0.122237843035546, 0.0310368464454354],
    [0.0876089254981147, 0.0211679115681786],
    [0.0634768221410440, 0.0144063683868745],
    [0.0465039840105641, 0.00978924269482652],
    [0.0344266827716278, 0.00664408439068874],
    [0.0257242783516506, 0.00450544716712813],
    [0.0193755544520413, 0.00305315351907877],
    [0.0146903917819319, 0.00206791778105196],
    [0.0111974627383082, 0.00140003635930091],
    [0.00857053238955398, 0.000947544804964982],
    [0.00658041847300848, 0.000641105260322919],
    [0.00506381681449013, 0.000433668496001185],
    [0.00390244393682467, 0.000293262283597660],
    [0.00300975727491464, 0.000198257049829346],
    [0.00232154357616764, 0.000133981390910652],
    [0.00178971245190972, 9.04959160577170e-05],
    [0.00137800312031860, 6.10822842822403e-05],
    [0.00105883886239522, 4.11880684659100e-05],
    [0.000811143173925241, 2.77315860712520e-05],
    [0.000618760571940855, 1.86311055568900e-05],
    [0.000469244060373318, 1.24766800830925e-05],
    [0.000352982242141694, 8.31421841730376e-06],
    [0.000262548116581223, 5.49939608245101e-06],
    [0.000192183828709499, 3.59590888237007e-06],
    [0.000137421670477384, 2.30856502155315e-06],
    [9.47963527701116e-05, 1.43803878131529e-06],
    [6.16136797290342e-05, 8.49369903646637e-07],
    [3.57785133068572e-05, 4.51254677077161e-07],
    [1.56630330315882e-05, 1.82044542765052e-07],
    [0.0, 0.0]
])

print("Complete")
import numpy as np
import scipy.io
import warnings

warnings.filterwarnings('ignore')

try:
    from EQPreg import EQPreg
except ImportError:
    print("EQPreg module not found.")
    def EQPreg(t, x):
        n = len(t) if isinstance(t, np.ndarray) else 1
        return (np.zeros(n), np.zeros(n), np.zeros(n),
                np.zeros(n), np.zeros(n), np.zeros(n), np.zeros(n))

print("Loading data...")
data_vars = {}

for i in range(1, 7):
    try:
        sqp_data = scipy.io.loadmat(f'GASQP{i}.mat')[f'rgasqp{i}']
        data_vars[f'{i}c1'] = sqp_data[:20, :94, 0]
        data_vars[f'{i}c2'] = sqp_data[:20, :94, 1]
        data_vars[f'{i}c3'] = sqp_data[:20, :94, 2]
    except FileNotFoundError:
        print(f"GASQP{i}.mat not found.")
        for c in range(1, 4):
            data_vars[f'{i}c{c}'] = np.zeros((20, 94))
    except KeyError:
        print(f"Key 'rgasqp{i}' not found in GASQP{i}.mat.")
        for c in range(1, 4):
            data_vars[f'{i}c{c}'] = np.zeros((20, 94))

print("Processing data...")
time_steps = np.linspace(0, 10, 41)
num_rows = 20

results_df = {}
results_t = {}

for key, matrix in data_vars.items():
    df_arr = np.zeros((num_rows, len(time_steps)))
    t_arr = np.zeros((num_rows, len(time_steps)))
    
    for i in range(num_rows):
        row_data = matrix[i, :90]
        outputs = EQPreg(time_steps, row_data)
        df_arr[i, :] = outputs[1]
        t_arr[i, :] = outputs[4]

    results_df[key] = df_arr
    results_t[key] = t_arr

print("Process complete.")
print(f"Total scenarios processed: {len(results_df)}")
# Calculate statistical tables for all scenarios and cases
print("Calculating Statistical Tables")

# Define scenarios and cases
scenarios = range(1, 7)  # Scenarios 1 to 6
cases = range(1, 4)      # Cases 1 to 3

# Dictionary to store all statistical tables
table_stats = {}

# Create Sc_map for reference data (assuming these are already defined from earlier code)
Sc_map = {
    '1c1': Sc1c1, '1c2': Sc1c2, '1c3': Sc1c3,
    '2c1': Sc2c1, '2c2': Sc2c2, '2c3': Sc2c3,
    '3c1': Sc3c1, '3c2': Sc3c2, '3c3': Sc3c3,
    '4c1': Sc4c1, '4c2': Sc4c2, '4c3': Sc4c3,
    '5c1': Sc5c1, '5c2': Sc5c2, '5c3': Sc5c3,
    '6c1': Sc6c1, '6c2': Sc6c2, '6c3': Sc6c3
}

# Create AE_df and AE_t dictionaries to store absolute errors
AE_df = {}
AE_t = {}

# Calculate absolute errors for each scenario and case
for key in Sc_map.keys():
    # Ensure results_df and results_t exist
    if key in results_df and key in results_t:
        sim_df = results_df[key]  # Shape (20, 41)
        sim_t = results_t[key]    # Shape (20, 41)
        
        ref_df = Sc_map[key][:, 0]  # Shape (41,)
        ref_t = Sc_map[key][:, 1]   # Shape (41,)
        
        num_runs = sim_df.shape[0]
        AE_df[key] = np.zeros((num_runs, len(ref_df)))
        AE_t[key] = np.zeros((num_runs, len(ref_t)))
        
        # Calculate absolute errors
        for i in range(num_runs):
            AE_df[key][i, :] = np.abs(sim_df[i, :] - ref_df[:])
            AE_t[key][i, :] = np.abs(sim_t[i, :] - ref_t[:])

# Now calculate statistical tables
for s in scenarios:
    for c in cases:
        key = f'{s}c{c}'
        
        if key in AE_df and key in AE_t:
            df_flat = AE_df[key].flatten()
            t_flat = AE_t[key].flatten()
            
            stats_matrix = np.array([
                [np.max(df_flat),    np.max(t_flat)],
                [np.min(df_flat),    np.min(t_flat)],
                [np.mean(df_flat),   np.mean(t_flat)],
                [np.std(df_flat),    np.std(t_flat)],
                [np.median(df_flat), np.median(t_flat)],
                [np.var(df_flat),    np.var(t_flat)]
            ])
            
            table_stats[key] = stats_matrix
            
            print(f"Table_stat_s{s}_c{c}:")
            print(stats_matrix)
            print("-" * 30)

print("Statistical tables calculation completed.")
print(f"Total tables generated: {len(table_stats)}")
print("Calculating MAE, RMSE, and Theil's Coefficient")

# Create ordered list of all scenario-case combinations
ordered_keys = [f'{s}c{c}' for s in range(1, 7) for c in range(1, 4)]

# ==========================================
# 1. Calculate MAE (Mean Absolute Error)
# ==========================================
mae_list = []

for key in ordered_keys:
    if key in AE_df and key in AE_t:
        # MATLAB: mean(AEdfgasqps1c1')' - takes mean across columns (axis=1)
        mae_df = np.mean(AE_df[key], axis=1)  # Shape: (20,)
        mae_t = np.mean(AE_t[key], axis=1)    # Shape: (20,)
        
        mae_list.extend([mae_df, mae_t])

# Combine all MAE values into a matrix
mae_matrix = np.column_stack(mae_list) if mae_list else np.array([])

# Find minimum MAE value and its index
if mae_matrix.size > 0:
    bminmae = np.min(mae_matrix)
    ibminmae = np.unravel_index(np.argmin(mae_matrix), mae_matrix.shape)
else:
    bminmae = None
    ibminmae = None

# ==========================================
# 2. Calculate RMSE (Root Mean Square Error)
# ==========================================
rmse_list = []

for key in ordered_keys:
    if key in AE_df and key in AE_t:
        # MATLAB: sqrt(mean(AEdfgasqps1c1.^2, 2))
        rmse_df = np.sqrt(np.mean(AE_df[key]**2, axis=1))  # Shape: (20,)
        rmse_t = np.sqrt(np.mean(AE_t[key]**2, axis=1))    # Shape: (20,)
        
        rmse_list.extend([rmse_df, rmse_t])

# Combine all RMSE values into a matrix
RMSE_matrix = np.column_stack(rmse_list) if rmse_list else np.array([])

# Find minimum RMSE value and its index
if RMSE_matrix.size > 0:
    bRMSEae = np.min(RMSE_matrix)
    ibRMSEae = np.unravel_index(np.argmin(RMSE_matrix), RMSE_matrix.shape)
else:
    bRMSEae = None
    ibRMSEae = None

# ==========================================
# 3. Calculate Theil's Inequality Coefficient
# ==========================================
theil_list = []

for i, key in enumerate(ordered_keys):
    if key in results_df and key in results_t and key in Sc_map:
        # Get simulation results (20x41)
        sim_df = results_df[key]  # dfgasqps1c1
        sim_t = results_t[key]    # tgasqps1c1
        
        # Get reference data (Sc1c1)
        Sc_ref = Sc_map[key]
        
        # Extract reference columns
        # MATLAB: Sc1c1(1,:) and Sc1c1(2,:)
        ref_df_row = Sc_ref[0, :] if Sc_ref.shape[0] > 1 else Sc_ref[0, :]
        ref_t_row = Sc_ref[1, :] if Sc_ref.shape[0] > 1 else Sc_ref[0, :]
        
        # Take only first element as in MATLAB
        sim_df_first = sim_df[:, 0]  # dfgasqps1c1(i,1)
        sim_t_first = sim_t[:, 0]    # tgasqps1c1(i,1)
        ref_df_first = ref_df_row[0]  # Sc1c1(1,1)
        ref_t_first = ref_t_row[0]    # Sc1c1(2,1) or Sc1c1(1,1)
        
        # Get RMSE values for this scenario
        rmse_df_val = RMSE_matrix[:, i*2] if RMSE_matrix.size > 0 else np.zeros(20)
        rmse_t_val = RMSE_matrix[:, i*2 + 1] if RMSE_matrix.size > 0 else np.zeros(20)
        
        # Calculate Theil's coefficient for each run (i=1:20)
        theil_df = rmse_df_val / (np.sqrt(np.mean(sim_df_first**2)) + np.sqrt(np.mean(ref_df_first**2)))
        theil_t = rmse_t_val / (np.sqrt(np.mean(sim_t_first**2)) + np.sqrt(np.mean(ref_t_first**2)))
        
        theil_list.extend([theil_df, theil_t])

# Combine all Theil values into a matrix
Theil_matrix = np.column_stack(theil_list) if theil_list else np.array([])

# Find minimum Theil value and its index
if Theil_matrix.size > 0:
    bTheilae = np.min(Theil_matrix)
    ibTheilae = np.unravel_index(np.argmin(Theil_matrix), Theil_matrix.shape)
else:
    bTheilae = None
    ibTheilae = None

# ==========================================
# 4. Print Results
# ==========================================
print(f"MAE matrix shape: {mae_matrix.shape if mae_matrix.size > 0 else 'Empty'}")
print(f"Minimum MAE value: {bminmae}")
print(f"Minimum MAE location: {ibminmae}")

print(f"RMSE matrix shape: {RMSE_matrix.shape if RMSE_matrix.size > 0 else 'Empty'}")
print(f"Minimum RMSE value: {bRMSEae}")
print(f"Minimum RMSE location: {ibRMSEae}")

print(f"Theil matrix shape: {Theil_matrix.shape if Theil_matrix.size > 0 else 'Empty'}")
print(f"Minimum Theil value: {bTheilae}")
print(f"Minimum Theil location: {ibTheilae}")
print("Calculating NSE and VAF metrics")

ordered_keys = [f'{s}c{c}' for s in range(1, 7) for c in range(1, 4)]

# ==========================================
# 1. Nash-Sutcliffe Efficiency (NSE)
# ==========================================
nse_list = []

for key in ordered_keys:
    if key in AE_df and key in AE_t and key in Sc_map:
        # Get absolute error data (already calculated as |sim - ref|)
        ae_df = AE_df[key]  # Shape: (20, 41)
        ae_t = AE_t[key]    # Shape: (20, 41)
        
        # Get reference data
        ref_df = Sc_map[key][:, 0]  # Shape: (41,)
        ref_t = Sc_map[key][:, 1]   # Shape: (41,)
        
        # Calculate denominator: sum((Ref - mean(Ref))^2)
        denom_df = np.sum((ref_df - np.mean(ref_df))**2)
        denom_t = np.sum((ref_t - np.mean(ref_t))**2)
        
        # Calculate NSE for each run (i=1:20)
        for i in range(20):
            # MATLAB: 1 - (sum(AEdfgasqps1c1(i,:).^2) / denominator)
            nse_df_val = 1 - (np.sum(ae_df[i, :]**2) / denom_df)
            nse_t_val = 1 - (np.sum(ae_t[i, :]**2) / denom_t)
            
            nse_list.append([nse_df_val, nse_t_val])

# Create NSE matrix (20 runs × 36 columns)
NSE_matrix = np.zeros((20, 36))
for col in range(36):
    run_idx = col % 20
    for row in range(20):
        if row == run_idx:
            NSE_matrix[row, col] = nse_list[col][0] if col % 2 == 0 else nse_list[col][1]

# Calculate NSEE (Absolute deviation from 1)
NSEE_matrix = np.abs(NSE_matrix - 1.0)

# Find minimum NSEE
bNSEae = np.min(NSEE_matrix)
ibNSEae = np.unravel_index(np.argmin(NSEE_matrix), NSEE_matrix.shape)

# ==========================================
# 2. Variance Accounted For (VAF)
# ==========================================
vaf_list = []

for key in ordered_keys:
    if key in AE_df and key in AE_t and key in Sc_map:
        # Get absolute error data
        ae_df = AE_df[key]  # Shape: (20, 41)
        ae_t = AE_t[key]    # Shape: (20, 41)
        
        # Get reference data
        ref_df = Sc_map[key][:, 0]  # Shape: (41,)
        ref_t = Sc_map[key][:, 1]   # Shape: (41,)
        
        # Calculate reference variances (ddof=1 for sample variance)
        var_ref_df = np.var(ref_df, ddof=1)
        var_ref_t = np.var(ref_t, ddof=1)
        
        # Calculate VAF for each run (i=1:20)
        for i in range(20):
            # MATLAB: (1 - (var(AEdfgasqps1c1(i,:)) / var(Sc1c1(:,1)))) * 100
            var_ae_df = np.var(ae_df[i, :], ddof=1)
            var_ae_t = np.var(ae_t[i, :], ddof=1)
            
            vaf_df_val = (1 - (var_ae_df / var_ref_df)) * 100
            vaf_t_val = (1 - (var_ae_t / var_ref_t)) * 100
            
            vaf_list.append([vaf_df_val, vaf_t_val])

# Create VAF matrix (20 runs × 36 columns)
VAF_matrix = np.zeros((20, 36))
for col in range(36):
    run_idx = col % 20
    for row in range(20):
        if row == run_idx:
            VAF_matrix[row, col] = vaf_list[col][0] if col % 2 == 0 else vaf_list[col][1]

# Calculate VAF Error (Absolute deviation from 100%)
VAFE_matrix = np.abs((VAF_matrix / 100.0) - 1.0)

# Find minimum VAF Error
bVAF = np.min(VAFE_matrix)
ibVAF = np.unravel_index(np.argmin(VAFE_matrix), VAFE_matrix.shape)

# Print results
print(f"NSE matrix shape: {NSE_matrix.shape}")
print(f"Minimum NSEE value: {bNSEae}")
print(f"Minimum NSEE location: {ibNSEae}")

print(f"VAF matrix shape: {VAF_matrix.shape}")
print(f"Minimum VAF Error value: {bVAF}")
print(f"Minimum VAF Error location: {ibVAF}")
print("Calculating Coefficient of Determination (R2)")

# Create R2 matrix
RM_matrix = np.zeros((20, 36))  # 20 runs × 36 columns (18 scenarios × 2 variables)

col_idx = 0
for s in range(1, 7):
    for c in range(1, 4):
        key = f'{s}c{c}'
        
        if key in AE_df and key in AE_t and key in Sc_map:
            # Get absolute errors (already calculated as |sim - ref|)
            ae_df = AE_df[key]  # Shape: (20, 41)
            ae_t = AE_t[key]    # Shape: (20, 41)
            
            # Get reference data - note MATLAB uses column vectors
            ref_df = Sc_map[key][:, 0]  # Shape: (41, 1) or (41,)
            ref_t = Sc_map[key][:, 1]   # Shape: (41, 1) or (41,)
            
            # Calculate denominator: sum((Ref - mean(Ref))^2)
            # MATLAB: sum((Sc1c1(:,1)' - mean(Sc1c1(:,1)')).^2)
            # Note the transpose ' in MATLAB code: Sc1c1(:,1)' converts column to row
            denom_df = np.sum((ref_df - np.mean(ref_df))**2)
            denom_t = np.sum((ref_t - np.mean(ref_t))**2)
            
            # Calculate R2 for each run (i=1:20)
            for i in range(20):
                # MATLAB: 1 - (sum(AEdfgasqps1c1(i,:).^2) / denominator)
                r2_df = 1 - (np.sum(ae_df[i, :]**2) / denom_df)
                r2_t = 1 - (np.sum(ae_t[i, :]**2) / denom_t)
                
                # Store in matrix (column order: df, t, df, t, ...)
                RM_matrix[i, col_idx] = r2_df
                RM_matrix[i, col_idx + 1] = r2_t
            
            col_idx += 2

# Calculate R2 Error (Absolute deviation from 1.0)
R2M_matrix = np.abs(RM_matrix - 1.0)

# Find minimum R2 Error
bRMae = np.min(R2M_matrix)
ibRMae = np.unravel_index(np.argmin(R2M_matrix), R2M_matrix.shape)

print(f"R2 matrix shape: {RM_matrix.shape}")
print(f"Minimum R2 Error value: {bRMae}")
print(f"Minimum R2 Error location (run, column): {ibRMae}")
import numpy as np
import matplotlib.pyplot as plt
import warnings

# Use ggplot style for better aesthetics
plt.style.use('ggplot')
warnings.filterwarnings('ignore')

# ==========================================
# 7b. MAE and Best Run Calculation
# ==========================================
print("--- Calculating MAE and finding Best Runs ---")

# We need to reconstruct the MAE matrix to find the best run for each case.
# This corresponds to the MATLAB lines:
# mae = [mean(AEdf...1)', mean(AEt...1)' ...]
# [bminmae, ibminmae] = min(mae)

mae_list = []

# Define ordered keys to match MATLAB's specific concatenation order
# (s1c1_df, s1c1_t, s1c2_df, s1c2_t ... s6c3_t)
ordered_keys = [f'{s}c{c}' for s in range(1, 7) for c in range(1, 4)]

for key in ordered_keys:
    # Retrieve Absolute Error matrices (20 runs x 41 time steps)
    # These AE_df and AE_t dictionaries must exist from the previous "Absolute Error Calculation" step.
    ae_df_vals = AE_df[key]
    ae_t_vals  = AE_t[key]
    
    # Calculate Mean Absolute Error across time steps (axis=1)
    # Result is a vector of 20 values (one per run)
    mae_run_df = np.mean(ae_df_vals, axis=1)
    mae_run_t  = np.mean(ae_t_vals, axis=1)
    
    mae_list.append(mae_run_df)
    mae_list.append(mae_run_t)

# Stack columns to create the MAE matrix (20 runs x 36 variables)
mae_matrix = np.column_stack(mae_list)

# Find the index of the run with the minimum MAE for each column
# axis=0 means we look down the rows (runs) to find the min
best_run_indices = np.argmin(mae_matrix, axis=0)

# Store the minimum MAE values as well
bminmae = np.min(mae_matrix, axis=0)

print("Best run indices calculated.")
# print("Indices:", best_run_indices)

# ==========================================
# 10. PLOTTING: Best Weights (Bar Charts)
# ==========================================
print("--- Plotting Best Weights for All Scenarios ---")

# Helper function to create the grouped bar chart
def plot_weights_bar(scenario_idx, case_idx, param_type, best_run_idx, weights_matrix):
    """
    Plots the best weights (alpha, w, beta) for a specific scenario and case.
    Mimics the MATLAB bar plot command.
    """
    # Extract the weights vector for the best run (first 90 elements)
    w_vector = weights_matrix[best_run_idx, :90]
    
    # Determine indices based on parameter type (f' or theta)
    # MATLAB: f' uses weights 1-45, theta uses weights 46-90
    if param_type == 'f_prime':
        start_idx = 0
        title_suffix = "f'"
    else:
        start_idx = 45
        title_suffix = r"\theta" # LaTeX formatting
        
    # Slice the weights into three groups: Alpha, W, Beta (15 neurons each)
    # Python Indexing:
    # Alpha: 0-14 (relative to start)
    # W:    15-29
    # Beta: 30-44
    alpha = w_vector[start_idx : start_idx+15]
    w     = w_vector[start_idx+15 : start_idx+30]
    beta  = w_vector[start_idx+30 : start_idx+45]
    
    # --- Plotting Configuration ---
    neurons = np.arange(15)  # X-axis: 0 to 14
    width = 0.25             # Width of bars
    
    fig, ax = plt.subplots(figsize=(10, 5))
    
    # Create grouped bars (Shift positions to group them)
    # Colors chosen to match standard MATLAB presentation (Blue, Orange/Yellow, Gray/Purple)
    ax.bar(neurons - width, alpha, width, label=r'$\alpha$', color='blue')
    ax.bar(neurons,        w,     width, label=r'$w$',      color='orange')
    ax.bar(neurons + width, beta,  width, label=r'$\beta$',   color='gray')
    
    # Labels and Title
    ax.set_ylabel('Numerical values')
    ax.set_xlabel('Weights (Neuron Index)')
    ax.set_title(f'Best Weights: Scenario {scenario_idx} Case {case_idx} for ${title_suffix}$')
    ax.set_xticks(neurons)
    ax.legend(loc='best')
    ax.grid(True, linestyle='--', alpha=0.5)
    
    # Show plot
    plt.tight_layout()
    plt.show()

# --- Main Plotting Loop ---
# Iterates through all 6 Scenarios and 3 Cases
for s in range(1, 7):
    for c in range(1, 4):
        # Construct key to access data (e.g., '1c1', '6c3')
        key = f'{s}c{c}'
        
        # Calculate the column index in the MAE matrix to find the best run.
        # The MAE matrix was constructed as [S1C1_df, S1C1_t, S1C2_df, S1C2_t ...]
        # We use the index for 'df' (f_prime) to select the best run for weights.
        # Formula: (Scenario-1)*6 + (Case-1)*2
        mae_col_idx = (s - 1) * 6 + (c - 1) * 2
        
        # Get the best run index from the previously calculated 'best_run_indices'
        best_run = best_run_indices[mae_col_idx]
        
        # Retrieve the weight matrix for this case using the correct dictionary: 'data_vars'
        current_weights = data_vars[key]
        
        # 1. Plot weights for f' (first 45 weights)
        plot_weights_bar(s, c, 'f_prime', best_run, current_weights)
        
        # 2. Plot weights for theta (next 45 weights)
        plot_weights_bar(s, c, 'theta', best_run, current_weights)

print("Best weight plotting completed.")
# ==========================================
# 11. PLOTTING: Numerical Comparisons
# ==========================================
print("--- Plotting Numerical Comparisons (Simulated vs Reference) ---")

def plot_comparison_scenario(scenario_idx, metric_type):
    """
    Plots comparison for all 3 cases of a scenario in one figure.
    metric_type: 'df' or 'theta'
    """
    plt.figure(figsize=(10, 6))
    
    colors = ['b', 'k', 'g'] # Matches MATLAB: Case 1(Blue), Case 2(Black), Case 3(Green)
    labels = [f'Case {c}' for c in range(1, 4)]
    
    # Plot References (Points)
    for c in range(1, 4):
        key = f'{scenario_idx}c{c}'
        col_idx = 0 if metric_type == 'df' else 1
        ref_data = Sc_map[key][:, col_idx]
        
        # Plot reference points
        plt.plot(time_steps, ref_data, 'o', markerfacecolor='yellow', markeredgecolor='red', 
                 markersize=4, label=f'Ref {labels[c-1]}' if c==1 else "") # Label once to avoid clutter

    # Plot Optimized Solutions (Lines)
    for c in range(1, 4):
        key = f'{scenario_idx}c{c}'
        # Find best run index
        base_idx = (scenario_idx - 1) * 6 + (c - 1) * 2
        if metric_type == 'theta': base_idx += 1
        best_run = best_run_indices[base_idx]
        
        # Retrieve calculated data
        # results_df or results_t dictionaries from Step 3
        if metric_type == 'df':
            sim_data = results_df[key][best_run, :]
        else:
            sim_data = results_t[key][best_run, :]
            
        plt.plot(time_steps, sim_data, color=colors[c-1], linewidth=1.5, label=f'Opt {labels[c-1]}')

    # Formatting
    plt.xlabel('Input (t)')
    plt.ylabel('Numerical values')
    var_name = "f'" if metric_type == 'df' else r'\theta'
    plt.title(f'Graph of "{var_name}" for Scenario {scenario_idx}')
    plt.legend(loc='best')
    plt.grid(True)
    # plt.savefig(f'NV_s{scenario_idx}_{metric_type}.png')
    plt.show()

# Generate plots for all scenarios
for s in range(1, 7):
    plot_comparison_scenario(s, 'df')
    plot_comparison_scenario(s, 'theta')


# ==========================================
# 12. PLOTTING: Error Metrics (RMSE, Theil, R2, NSEE)
# ==========================================
print("--- Plotting Error Metrics Trends ---")

def plot_metric_evolution(matrix, metric_name, ylabel, log_scale=True):
    """
    Plots the metric evolution over 20 runs for each scenario.
    matrix: The calculated metric matrix (20 runs x 36 variables)
    """
    runs = np.arange(1, 21)
    
    # Loop through each scenario to create a separate plot
    for s in range(1, 7):
        plt.figure(figsize=(8, 5))
        
        # Calculate column indices for this scenario
        # Each scenario has 6 columns: c1_df, c1_t, c2_df, c2_t, c3_df, c3_t
        start_col = (s - 1) * 6
        
        # Extract data for the 3 cases (df and theta)
        # c1
        y_c1_df = matrix[:, start_col]
        y_c1_t  = matrix[:, start_col + 1]
        # c2
        y_c2_df = matrix[:, start_col + 2]
        y_c2_t  = matrix[:, start_col + 3]
        # c3
        y_c3_df = matrix[:, start_col + 4]
        y_c3_t  = matrix[:, start_col + 5]
        
        # Plotting
        # Solid lines for f' (df), Dashed for theta (t)
        # Colors: Red(c1), Green(c2), Blue(c3) matches MATLAB logic
        if log_scale:
            plt.semilogy(runs, y_c1_df, 'o-r', linewidth=2, label="f': Case 1")
            plt.semilogy(runs, y_c2_df, 's-g', linewidth=2, label="f': Case 2")
            plt.semilogy(runs, y_c3_df, 'd-b', linewidth=2, label="f': Case 3")
            plt.semilogy(runs, y_c1_t,  '--r', linewidth=2, label=r"$\theta$: Case 1")
            plt.semilogy(runs, y_c2_t,  '--g', linewidth=2, label=r"$\theta$: Case 2")
            plt.semilogy(runs, y_c3_t,  '--b', linewidth=2, label=r"$\theta$: Case 3")
        else:
            plt.plot(runs, y_c1_df, 'o-r', linewidth=2, label="f': Case 1")
            plt.plot(runs, y_c2_df, 's-g', linewidth=2, label="f': Case 2")
            plt.plot(runs, y_c3_df, 'd-b', linewidth=2, label="f': Case 3")
            plt.plot(runs, y_c1_t,  '--r', linewidth=2, label=r"$\theta$: Case 1")
            plt.plot(runs, y_c2_t,  '--g', linewidth=2, label=r"$\theta$: Case 2")
            plt.plot(runs, y_c3_t,  '--b', linewidth=2, label=r"$\theta$: Case 3")

        plt.xlabel('Runs')
        plt.ylabel(ylabel)
        plt.title(f'{metric_name} - Scenario {s}')
        plt.legend(loc='best', fontsize=8)
        plt.grid(True, which="both", linestyle='--')
        plt.tight_layout()
        plt.show()

# Assuming matrices exist from previous steps. 
# If not, we construct RMSE_matrix for demonstration using AE_df/AE_t
# (In a full run, these matrices come from Sections 7, 8, 10)

# RMSE Plot
# We need to construct the RMSE matrix if it wasn't strictly saved as a variable 'RMSE_matrix'
rmse_list_temp = []
for s in range(1, 7):
    for c in range(1, 4):
        key = f'{s}c{c}'
        # RMSE = sqrt(mean(AE^2))
        rmse_df = np.sqrt(np.mean(AE_df[key]**2, axis=1))
        rmse_t  = np.sqrt(np.mean(AE_t[key]**2, axis=1))
        rmse_list_temp.extend([rmse_df, rmse_t])
RMSE_matrix_plot = np.column_stack(rmse_list_temp)

plot_metric_evolution(RMSE_matrix_plot, 'RMSE Error', 'RMSE')

# Theil Plot (Using Theil_matrix from Section 7)
if 'Theil_matrix' in locals():
    plot_metric_evolution(Theil_matrix, 'Theil Index', 'Value')

# R2 Error Plot (Using R2M_matrix from Section 10)
if 'R2M_matrix' in locals():
    plot_metric_evolution(R2M_matrix, 'R2 Error (abs(R2-1))', 'R2 Values')

# NSEE Plot (Using NSEE_matrix from Section 8)
if 'NSEE_matrix' in locals():
    plot_metric_evolution(NSEE_matrix, 'NSE Error', 'NSEE')


# ==========================================
# 13. PLOTTING: Fitness (Area Plots)
# ==========================================
print("--- Plotting Fitness (Area Plots) ---")

# Dark color palette (as defined in MATLAB code)
colors_dark = [
    [0.00, 0.28, 0.46], # Dark Navy Blue
    [0.66, 0.24, 0.05], # Dark Burnt Orange
    [0.72, 0.53, 0.07], # Dark Gold
    [0.38, 0.12, 0.42], # Dark Purple
    [0.31, 0.49, 0.12], # Dark Forest Green
    [0.49, 0.05, 0.12]  # Dark Maroon
]

runs_x = np.arange(1, 21)

for s in range(1, 7):
    # Prepare data for stackplot
    # MATLAB: scenarios{s} = [mean(AE1c1), mean(AEt1c1), mean(AE1c2)...]
    # We need the MEAN absolute error per run (averaged over time)
    
    # Collect the 6 series for this scenario
    series_list = []
    labels_list = []
    
    for c in range(1, 4):
        key = f'{s}c{c}'
        # Mean across time steps (axis 1)
        mae_df = np.mean(AE_df[key], axis=1)
        mae_t  = np.mean(AE_t[key],  axis=1)
        
        series_list.append(mae_df)
        series_list.append(mae_t)
        labels_list.extend([f'C{c} df', f'C{c} theta'])
    
    # Stackplot requires data to be stacked
    y_stack = np.row_stack(series_list)
    
    fig, ax = plt.subplots(figsize=(10, 6))
    ax.stackplot(runs_x, y_stack, labels=labels_list, colors=colors_dark, alpha=0.8)
    
    ax.set_title(f'Fitness Landscape - Scenario {s}')
    ax.set_xlabel('Runs')
    ax.set_ylabel('Fitness (Accumulated MAE)')
    ax.set_yscale('log') # MATLAB uses 'yscale', 'log'
    ax.set_xlim(1, 20)
    ax.set_xticks([1, 5, 10, 15, 20])
    
    # Dark theme grid styling
    ax.grid(True, which='major', color=[0.4, 0.4, 0.4], alpha=0.3)
    ax.grid(True, which='minor', color=[0.6, 0.6, 0.6], alpha=0.1)
    ax.set_facecolor('#f2f2f2') # Light gray background
    
    # plt.legend(loc='upper right')
    plt.show()

print("All plots generated successfully.")
import matplotlib.pyplot as plt
import numpy as np

print("Creating bestweights matrices and 3D bar plots")

# ============================================
# 1. Create bestweights matrices
# ============================================

# Initialize bestweights matrices
bestweights_df = np.zeros((45, 18))  # 45 weights × 18 cases
bestweights_t = np.zeros((45, 18))   # 45 weights × 18 cases

# Fill matrices based on ibminmae indices
col_idx = 0
for s in range(1, 7):
    for c in range(1, 4):
        key = f'{s}c{c}'
        
        if key in data_sqp and ibminmae is not None:
            # Get the run index for this scenario from ibminmae
            run_idx = ibminmae[0] if isinstance(ibminmae, tuple) else ibminmae[0]
            
            # Extract weights 1-45 for df parameter
            bestweights_df[:, col_idx] = data_sqp[key][run_idx, :45]
            
            # Extract weights 46-90 for t parameter
            bestweights_t[:, col_idx] = data_sqp[key][run_idx, 45:90]
        
        col_idx += 1

print(f"Shape of bestweights_df: {bestweights_df.shape}")
print(f"Shape of bestweights_t: {bestweights_t.shape}")

# ============================================
# 2. 3D Bar Plots for Scenario 1
# ============================================

# Function to create 3D bar plot
def create_3d_bar(data, title, zlim=None):
    fig = plt.figure(figsize=(10, 8))
    ax = fig.add_subplot(111, projection='3d')
    
    # Reshape 45 weights into 3 groups of 15
    group1 = data[:15]
    group2 = data[15:30]
    group3 = data[30:45]
    
    # Create x positions for bars
    x_pos = np.arange(15)
    y_pos = np.array([0, 1, 2])  # 3 groups
    
    # Plot bars
    for i in range(15):
        ax.bar3d(x_pos[i], y_pos[0], 0, 0.8, 0.8, group1[i], shade=True)
        ax.bar3d(x_pos[i], y_pos[1], 0, 0.8, 0.8, group2[i], shade=True)
        ax.bar3d(x_pos[i], y_pos[2], 0, 0.8, 0.8, group3[i], shade=True)
    
    # Set labels
    ax.set_xlabel('Neuron Index')
    ax.set_ylabel('Parameter Group')
    ax.set_zlabel('Weight Value')
    ax.set_title(title)
    
    # Set y ticks and labels
    ax.set_yticks([0, 1, 2])
    ax.set_yticklabels([r'$\alpha$', r'$w$', r'$\beta$'])
    
    # Set z limits if provided
    if zlim:
        ax.set_zlim(zlim)
    
    return fig, ax

# Create plots for Scenario 1 (first 3 columns)
scenario1_cases = ['Case 1', 'Case 2', 'Case 3']

for i, case_name in enumerate(scenario1_cases):
    # df parameter plots
    fig_df, ax_df = create_3d_bar(
        bestweights_df[:, i], 
        f'Best df Weights - Scenario 1, {case_name}',
        zlim=(-3.5, 3)
    )
    
    # t parameter plots
    fig_t, ax_t = create_3d_bar(
        bestweights_t[:, i],
        f'Best t Weights - Scenario 1, {case_name}',
        zlim=(-3.5, 3)
    )

# ============================================
# 3. 3D Bar Plots for Scenario 2, Case 1
# ============================================

# Scenario 2, Case 1 is column 3 in 0-indexed (4th column in MATLAB's 1-indexed)
fig_s2c1_df, ax_s2c1_df = create_3d_bar(
    bestweights_df[:, 3],  # Column index 3 = Scenario 2, Case 1
    'Best df Weights - Scenario 2, Case 1',
    zlim=(-4.1, 4.3)
)

fig_s2c1_t, ax_s2c1_t = create_3d_bar(
    bestweights_t[:, 3],  # Column index 3 = Scenario 2, Case 1
    'Best t Weights - Scenario 2, Case 1',
    zlim=(-3.2, 4.7)
)

# ============================================
# 4. Show all plots
# ============================================
plt.show()

print("All 3D bar plots created")